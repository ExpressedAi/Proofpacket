# Audit Specifications for P vs NP Proof
# Defines precise criteria for E0-E4 audits and kill-switches

audits:
  E0:
    name: "Calibration"
    description: "Bridge detection baseline"
    criteria:
      - n_bridges > 0
      - message: "E0: {n_bridges} bridges detected"
    pass_condition: "n_bridges > 0"
    
  E1:
    name: "Vibration"
    description: "Coherent bridges detected"
    criteria:
      - n_eligible > 0
      - eligible_bridges have K > threshold
    pass_condition: "n_eligible > 0"
    
  E2:
    name: "Symmetry"
    description: "Renaming-invariant (E2 symmetry)"
    criteria:
      - Bridges invariant under variable/clause relabeling
      - No label peeking in bridge detection
    pass_condition: "OK (renaming-invariant)"
    
  E3:
    name: "Micro-nudge"
    description: "Causal lift on bridge coherence"
    criteria:
      - Eligible bridges with K > 0
      - Causal response to perturbations
    pass_condition: "n_eligible > 0 with K > 0"
    
  E4:
    name: "RG Persistence"
    description: "Integer-thinning + survivor prefix"
    criteria:
      thinning_slope:
        condition: "slope > 0"
        threshold: 0.0
        message: "thinning slope={slope:.3f}"
      survivor_prefix:
        condition: "low_order_K >= high_order_K"
        message: "low-order K={low_K:.3f}, high-order K={high_K:.3f}"
    pass_condition: "thinning_slope > 0 AND low_order_K >= high_order_K"

ci_gates:
  gate_R:
    name: "Robustness Gate"
    perturb_norm: "delta_star/2"
    checks:
      - preserve: "E4.slope_sign"
      - preserve: "E4.prefix_set"
    file: "proofs/lean/ci_gates.lean"
    function: "gate_R_robustness"
    
  gate_M:
    name: "MWU Gate"
    checks:
      - bound: "E[ΔΨ] >= γ_MWU"
      - steps: "time_to_witness <= poly(n) with p>=2/3"
    file: "proofs/lean/ci_gates.lean"
    function: "gate_M_mwu"
    
  gate_C:
    name: "Constructibility Gate"
    checks:
      - runtime: "time(build_cover) ∈ n^{O(1)}"
      - count: "|B(F)| ∈ n^{O(1)}"
    file: "proofs/lean/ci_gates.lean"
    function: "gate_C_constructibility"
    
  gate_E:
    name: "Existence Gate (Restricted)"
    checks:
      - slope: "λ_hat >= γ(ε,Δ) - τ"
      - prefix: "prefix_gap >= ρ(ε,Δ) - τ"
      - null: "permutation_null ⇒ ROC collapses"
    file: "proofs/lean/ci_gates.lean"
    function: "gate_E_existence"

kill_switches:
  slope_failure:
    name: "E4 Slope Failure"
    condition: "E4 thinning slope ≤ 0 consistently on a test family"
    threshold: "slope ≤ 0 in > 50% of trials"
    action: "demote A3.1"
    severity: "critical"
    
  prefix_failure:
    name: "E4 Prefix Failure"
    condition: "E4 prefix fails with success prob < 1/3"
    threshold: "success_rate < 0.33"
    action: "demote A3.1"
    severity: "critical"
    
  exponential_steps:
    name: "Exponential Harmony Steps"
    condition: "Expected Harmony steps grow like 2^Ω(n^α) for any α > 0"
    threshold: "exponent > 0 in log-log fit of steps vs n"
    action: "demote A3.3"
    severity: "critical"
    
  super_poly_order:
    name: "Super-Polynomial Cover Order"
    condition: "Cover order needed grows super-poly on typical inputs"
    threshold: "order > n^c for any constant c"
    action: "demote A3.2"
    severity: "critical"
    
  witness_failure:
    name: "Witness Finding Failure"
    condition: "Harmony Optimizer success rate < 2/3"
    threshold: "success_rate < 0.67"
    action: "demote A3.3"
    severity: "critical"

adversarial_families:
  random_3sat_phase_transition:
    name: "Random 3-SAT near Phase Transition"
    description: "m/n ≈ 4.26 (hard instances)"
    parameters:
      clause_ratio: 4.26
      k: 3
    expected_behavior:
      - "If A3 false: E4 persistence dies or Harmony stalls"
      - "If A3 true: Should still find covers and witnesses"
    metrics:
      - e4_slope
      - e4_prefix_pass_rate
      - harmony_success_rate
      - harmony_steps_distribution
      
  planted_satisfiable_camouflage:
    name: "Planted Satisfiable with Camouflage"
    description: "Random clause noise added to planted solution"
    parameters:
      noise_level: 0.1
      planted: true
    expected_behavior:
      - "Tests robustness (A3.4)"
      - "Should maintain E4 persistence under noise"
    metrics:
      - e4_slope_under_noise
      - harmony_success_rate
      - bridge_order_distribution
      
  xor_sat_gadgets:
    name: "XOR-SAT Gadgets Composed into CNF"
    description: "Stress spectral/equational structure"
    parameters:
      gadget_size: 3
      composition: "linear"
    expected_behavior:
      - "If cover must be high order: breaks A3.1"
      - "If low-order covers exist: should pass"
    metrics:
      - bridge_order_distribution
      - e4_persistence
      - harmony_convergence
      
  goldreich_generator:
    name: "Goldreich Generator Instances"
    description: "Predicate on expander (canonical 'local, hard' family)"
    parameters:
      predicate: "random"
      expander_degree: 5
    expected_behavior:
      - "Great for breaking bridge locality assumptions"
      - "If A3 relies on local structure: should fail"
    metrics:
      - bridge_locality
      - e4_slope
      - harmony_success_rate
      
  high_treewidth_benchmarks:
    name: "High Treewidth Benchmarks"
    description: "MIXSAT, SATLIB hard sets"
    parameters:
      treewidth: "high"
      source: "SATLIB"
    expected_behavior:
      - "If persistence relies on small separators: should be kryptonite"
      - "Tests A3.1 existence claim"
    metrics:
      - treewidth
      - bridge_order
      - e4_persistence
      - harmony_success_rate

metrics:
  e4_slope:
    name: "E4 Thinning Slope"
    description: "λ in log K = β₀ - λ(p+q)"
    computation: "linear regression on log K vs order"
    threshold: "λ > 0"
    
  e4_prefix_pass_rate:
    name: "E4 Prefix Pass Rate"
    description: "Fraction of trials where low-order K >= high-order K"
    computation: "count(pass) / total_trials"
    threshold: "≥ 0.7"
    
  harmony_success_rate:
    name: "Harmony Optimizer Success Rate"
    description: "P(valid witness found)"
    computation: "count(valid) / total_trials"
    threshold: "≥ 2/3"
    
  harmony_steps_distribution:
    name: "Harmony Steps Distribution"
    description: "Distribution of iterations to find witness"
    computation: "quantiles of iterations"
    threshold: "median < n^e for some e"
    
  bridge_order_distribution:
    name: "Bridge Order Distribution"
    description: "Distribution of (p+q) orders in cover"
    computation: "histogram of orders"
    threshold: "max order ≤ n^c for some c"
    
  resource_scaling:
    name: "Resource Scaling R(n)"
    description: "Time/calls/space as function of n"
    computation: "log-log regression: log R = log c + k log n"
    threshold: "k < 3 AND R² > 0.8"

reporting:
  confusion_matrix:
    - true_positive: "POLY_COVER verdict AND valid witness"
    - false_positive: "POLY_COVER verdict AND invalid witness"
    - true_negative: "DELTA_BARRIER verdict AND no valid witness"
    - false_negative: "DELTA_BARRIER verdict AND valid witness exists"
    
  statistics:
    - precision: "TP / (TP + FP)"
    - recall: "TP / (TP + FN)"
    - accuracy: "(TP + TN) / (TP + TN + FP + FN)"
    - f1_score: "2 * (precision * recall) / (precision + recall)"

